From 3a2d7e1b625dfda565ce27a667a68242e259b82f Mon Sep 17 00:00:00 2001
From: jiangheng <jiangheng14@huawei.com>
Date: Thu, 11 Jan 2024 16:17:14 +0800
Subject: [PATCH] 0004-dpdk-master-core-donot-set-affinity-in-libstorage

---
 lib/eal/linux/eal.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/lib/eal/linux/eal.c b/lib/eal/linux/eal.c
index 28226fc..769c6d0 100644
--- a/lib/eal/linux/eal.c
+++ b/lib/eal/linux/eal.c
@@ -1219,7 +1219,9 @@ rte_eal_init(int argc, char **argv)
 
 	eal_check_mem_on_local_socket();
 
-	if (rte_thread_set_affinity_by_id(rte_thread_self(),
+	/* Master thread don't set affinity in LibStorage application */
+	if (strstr(program_invocation_short_name, "LibStorage") == NULL &&
+		rte_thread_set_affinity_by_id(rte_thread_self(),
 			&lcore_config[config->main_lcore].cpuset) != 0) {
 		rte_eal_init_alert("Cannot set affinity");
 		rte_errno = EINVAL;
-- 
2.33.0

